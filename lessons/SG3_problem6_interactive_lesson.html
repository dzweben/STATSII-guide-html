<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<title>SG3 Problem 6 — Interactive App (Split-Plot ANOVA + Contrasts)</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root{
    --ink:#1b1b1b;
    --muted:#5b5b5b;
    --bg:#f7f7f4;
    --card:#ffffff;
    --teal:#0d475c;
    --teal2:#eef6f8;
    --line:#dcdcdc;
    --warn:#fff8e1;
    --warn-border:#d7a34a;
    --good:#0f766e;
    --bad:#b91c1c;

    --c-grand:#111827;
    --c-right:#2563eb;
    --c-mixed:#7c3aed;
    --c-cell:#f59e0b;
  }
  body{font-family: Georgia, serif; margin:0; background:var(--bg); color:var(--ink);}
  header{background:var(--teal); color:#fff; padding:22px 28px;}
  header h1{margin:0 0 6px; font-size:24px;}
  header p{margin:0; opacity:.92; max-width:1100px;}
  .container{max-width:1150px; margin:0 auto; padding:18px 28px 60px;}

  .card{background:var(--card); border:1px solid var(--line); border-radius:14px; padding:14px 16px; margin:14px 0;}
  .panel{border:1px solid var(--warn-border); background:var(--warn); border-radius:10px; padding:12px 14px; margin:10px 0;}
  .panel h4{margin:0 0 6px; color:#8a5a00;}
  h2{margin:6px 0 10px; font-size:20px;}
  h3{margin:10px 0 8px; font-size:16px;}
  .muted{color:var(--muted);} 

  .kpi{display:flex; gap:10px; flex-wrap:wrap;}
  .kpi .pill{background:var(--teal2); border:1px solid #cfe3ea; border-radius:999px; padding:6px 10px; font-weight:700; color:var(--teal);}

  .grid{display:grid; gap:12px; grid-template-columns:1fr;}
  @media (min-width: 980px){ .grid.two{grid-template-columns: 1.2fr .8fr;} }

  details{background:var(--card); border:1px solid var(--line); border-radius:12px; margin:10px 0; padding:10px 12px;}
  summary{font-weight:800; cursor:pointer;}

  details.pill{border:0; padding:0; background:transparent;}
  details.pill > summary{
    display:inline-block; font-size:14px; font-weight:800; color:var(--teal);
    background:var(--teal2); border:1px solid #cfe3ea; border-radius:999px;
    padding:6px 10px; margin:6px 0 0; list-style:none;
  }
  details.pill > summary::-webkit-details-marker{display:none;}
  details.pill .answer{padding:10px 8px; border:1px dashed #cfe3ea; border-radius:10px; margin-top:8px; background:#fcfeff;}

  pre.rout{background:#f6f6f6; border:1px solid #ddd; border-radius:10px; padding:10px 12px; overflow-x:auto;}
  pre,code{font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; font-size: 13px;}

  .chips{display:flex; flex-wrap:wrap; gap:8px; margin:10px 0 0;}
  .chip{border-radius:999px; padding:6px 10px; border:1px solid var(--line); background:#fff; font-weight:800; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto;}
  .chip small{font-weight:700; opacity:.75; margin-right:6px;}
  .chip.grand{border-color:#cbd5e1; color:var(--c-grand);}
  .chip.right{border-color:#bfdbfe; background:#eff6ff; color:var(--c-right);}
  .chip.mixed{border-color:#ddd6fe; background:#f5f3ff; color:var(--c-mixed);}
  .chip.cell{border-color:#fde68a; background:#fffbeb; color:#92400e;}

  .calc-row{display:grid; grid-template-columns: 1fr; gap:10px; border:1px solid var(--line); border-radius:12px; padding:12px; background:#fbfeff; margin:10px 0;}
  @media (min-width: 980px){ .calc-row{grid-template-columns: 1.2fr .8fr;} }

  .calc-box{border:1px solid #cfe3ea; background:var(--teal2); border-radius:12px; padding:10px 12px;}
  .calc-box label{display:block; font-weight:900; color:var(--teal); margin-bottom:6px;}
  .calc-box input{width:100%; padding:10px 10px; border-radius:10px; border:1px solid #cfe3ea; font-size:15px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;}
  select{width:100%; padding:8px 10px; border-radius:10px; border:1px solid #cbd5e1; background:#fff; font-weight:700;}
  .btns{display:flex; gap:8px; flex-wrap:wrap; margin-top:8px;}
  button{cursor:pointer; border-radius:10px; border:1px solid var(--line); background:#fff; padding:8px 10px; font-weight:800;}
  button.primary{border-color:#cfe3ea; background:#e3f1f5; color:var(--teal);} 
  button.danger{border-color:#fecaca; background:#fff1f2; color:var(--bad);} 

  .feedback{margin-top:8px; font-weight:900; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto;}
  .ok{color:var(--good);} .no{color:var(--bad);} 
  .step{margin-top:8px; padding:10px 12px; border-left:4px solid #cfe3ea; background:#fcfeff; border-radius:10px;}

  table.tbl{border-collapse:collapse; width:100%; margin:10px 0;}
  table.tbl th, table.tbl td{border:1px solid #bbb; padding:6px 8px; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto; font-size: 13px;}
  table.tbl th{background:#f0f0f0;}
  table.tbl input{width:100%; padding:8px; border-radius:8px; border:1px solid #cbd5e1; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;}
  .right{text-align:right;}
  .center{text-align:center;}

  .sym{ font-weight:900; color:#0b1220; font-size:16px; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto; }
.sym sub{ font-weight:900; font-size: 12px; vertical-align: baseline; position: relative; bottom: -0.2em; }
.sym .dots{ letter-spacing: .04em; }
  .status{ font-weight:900; }
  .status.ok{ color: var(--good); }
  .status.lock{ color: #6b7280; }

  .pick{ cursor:pointer; padding:2px 6px; border-radius:8px; border:1px solid transparent; }
  .pick.active{ border-color:#93c5fd; background: rgba(147,197,253,.15); }
  .pick.wrong{ border-color:#fecaca; background: rgba(254,202,202,.10); }

  .hidden{display:none;}

  /* Floating calculator */
  #floatCalc{ position:fixed; right:16px; bottom:16px; width:340px; max-width: calc(100vw - 32px);
    background:#ffffff; border:1px solid var(--line); border-radius:14px; box-shadow: 0 18px 40px rgba(0,0,0,.18);
    z-index:9999; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto; }

  /* Floating R output drawer */
  #floatROut{ position:fixed; left:16px; bottom:16px; width:520px; max-width: calc(100vw - 32px);
    background:#ffffff; border:1px solid var(--line); border-radius:14px; box-shadow: 0 18px 40px rgba(0,0,0,.18);
    z-index:9998; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto; }
  #floatROut header{ background:#111827; color:#fff; padding:10px 12px; border-radius:14px 14px 0 0; display:flex; align-items:center; justify-content:space-between; }
  #floatROut header .title{ font-weight:900; font-size:13px; }
  #floatROut header button{ padding:6px 8px; border-radius:10px; border:1px solid rgba(255,255,255,.25); background:rgba(255,255,255,.12); color:#fff; }
  #floatROut .body{ padding:10px 12px; }
  #floatROut .tabs{ display:flex; gap:6px; flex-wrap:wrap; margin-bottom:8px; }
  #floatROut .tabs button{ padding:7px 9px; border-radius:999px; border:1px solid #374151; background:#0b1220; color:#e5e7eb; font-weight:900; }
  #floatROut .tabs button[aria-pressed="true"]{ background:#111827; border-color:#93c5fd; color:#fff; }
  #floatROut pre{ max-height: 320px; overflow:auto; margin:0; background:#0b1220; color:#e5e7eb; border:1px solid #374151; border-radius:10px; padding:10px 12px; }
  #floatCalc header{ background:var(--teal); color:#fff; padding:10px 12px; border-radius:14px 14px 0 0; display:flex; align-items:center; justify-content:space-between; }
  #floatCalc header .title{ font-weight:900; font-size:13px; }
  #floatCalc header button{ padding:6px 8px; border-radius:10px; border:1px solid rgba(255,255,255,.25); background:rgba(255,255,255,.12); color:#fff; }
  #floatCalc .body{ padding:10px 12px; }
  #floatCalc .row{ display:flex; gap:8px; }
  #floatCalc input{ width:100%; padding:10px 10px; border-radius:10px; border:1px solid #cbd5e1; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; font-size:14px; }
  #floatCalc .mini{ font-size:12px; color:var(--muted); margin:8px 0; }
  #floatCalc .keys{ display:flex; flex-wrap:wrap; gap:6px; margin-top:8px; }
  #floatCalc .keys button{ padding:7px 9px; border-radius:10px; border:1px solid var(--line); background:#fff; font-weight:900; }
  #floatCalc .keys button.ins{ background:var(--teal2); border-color:#cfe3ea; color:var(--teal); }
  #floatCalc .out{ margin-top:8px; padding:8px 10px; border-radius:10px; border:1px dashed #cfe3ea; background:#fcfeff; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; }
</style>
</head>
<body>
<header>
  <h1>SG3 Problem 6 — Interactive Worksheet App</h1>
  <p>Production-style practice: you compute, the app checks, and the answer key stays hidden until you reveal it. R output is right where you need it.</p>
</header>

<div class="container">

  <div class="card">
    <div class="kpi">
      <div class="pill">Design: 3×3 split-plot</div>
      <div class="pill">Between: brain damage (Left/Right/Control)</div>
      <div class="pill">Within: string type (Digits/Letters/Mixed)</div>
      <div class="pill">n = 18 subjects</div>
    </div>
    <div class="panel" style="margin-top:12px;">
      <h4>Prompt (from SG3)</h4>
      <p>We are looking at subjects’ ability to recall characters in a string based on (a) the type of string (digits/letters/mixed — within-subject factor) and (b) the type of brain damage the subject suffered (left brain / right brain / control — between-subject factor). The experiment is using a 3×3 design; n = 18. Note: when we tested assumptions we found equality of variances as well as equality of the covariance/variance matrices.</p>
    </div>
  </div>

  <!-- 6a -->
  <section class="card" id="p6a">
    <h2>6a — Fixed effects (α, β, αβ)</h2>

    <div class="grid two">
      <div>
        <div class="panel">
          <h4>Mini-lesson (short): what is an “effect” here?</h4>
          <p>In this question, an “effect” is a <strong>difference among means</strong>. You’ll plug in the relevant mean and subtract the grand mean (or combine means for the interaction cell effect).</p>
          <ul>
            <li><strong>Damage effect</strong> (Right): use the Right damage marginal mean.</li>
            <li><strong>Stimuli effect</strong> (Mixed): use the Mixed stimuli marginal mean.</li>
            <li><strong>Cell interaction effect</strong> (Right×Mixed): compare the cell mean to what you’d expect from the two main effects.</li>
          </ul>
        </div>

        <div class="panel">
          <h4>Step 0: map the symbols by clicking the number in the SG3 output</h4>
          <p class="muted">No dropdown guessing. Click <strong>Select in output</strong>, then click the correct number in the floating <strong>SG3 R output</strong> module. Notation: <span class="sym">Y&#772;</span> means “mean,” and the dots in the subscript indicate “averaged over.”</p>

          <div class="card" style="margin:10px 0 0; border-radius:12px;">
            <table class="tbl" id="map-6a">
              <thead>
                <tr>
                  <th class="center">Symbol</th>
                  <th>What you’re selecting</th>
                  <th class="center">Action</th>
                  <th class="center">Status</th>
                </tr>
              </thead>
              <tbody>
                <tr data-map="ybar_right">
                  <td class="center"><span class="sym">Y&#772;<sub>right<span class="dots">··</span></sub></span></td>
                  <td>Right <em>damage marginal mean</em> (from <code>em6.damage</code>)</td>
                  <td class="center"><button class="primary" data-action="select" data-target="ybar_right">Select in output</button></td>
                  <td class="center"><span class="status" data-status="ybar_right">locked</span></td>
                </tr>
                <tr data-map="ybar_mixed">
                  <td class="center"><span class="sym">Y&#772;<sub><span class="dots">·</span>mixed<span class="dots">·</span></sub></span></td>
                  <td>Mixed <em>stimuli marginal mean</em> (from <code>em6.stimuli</code>)</td>
                  <td class="center"><button class="primary" data-action="select" data-target="ybar_mixed">Select in output</button></td>
                  <td class="center"><span class="status" data-status="ybar_mixed">locked</span></td>
                </tr>
                <tr data-map="ybar_cell_right_mixed">
                  <td class="center"><span class="sym">Y&#772;<sub>right,mixed<span class="dots">·</span></sub></span></td>
                  <td>Right×Mixed <em>cell mean</em> (from <code>em6.cell</code>)</td>
                  <td class="center"><button class="primary" data-action="select" data-target="ybar_cell_right_mixed">Select in output</button></td>
                  <td class="center"><span class="status" data-status="ybar_cell_right_mixed">locked</span></td>
                </tr>
                <tr data-map="ybar_grand">
                  <td class="center"><span class="sym">Y&#772;<sub><span class="dots">···</span></sub></span></td>
                  <td>Grand mean (given in prompt)</td>
                  <td class="center"><button class="primary" data-action="select" data-target="ybar_grand">Select in output</button></td>
                  <td class="center"><span class="status" data-status="ybar_grand">locked</span></td>
                </tr>
              </tbody>
            </table>
            <div id="mapfb-6a" class="feedback" aria-live="polite"></div>
          </div>
        </div>

        <div class="chips" id="chips-6a" style="display:none;"></div>

        <div class="calc-row">
          <div>
            <h3>Compute + check</h3>
            <p class="muted" style="margin-top:0;">Type your numeric answer, click <strong>Check</strong>. Use 2 decimal places. Answers stay hidden until you click <strong>Reveal</strong>.</p>

            <div class="calc-box" data-prob="a_right">
              <label>α<sub>right</sub> = \(\bar Y_{right\cdot\cdot} - \bar Y_{\cdot\cdot\cdot}\)</label>
              <input inputmode="decimal" placeholder="e.g., 0.13" />
              <div class="btns">
                <button class="primary" data-action="check">Check</button>
                <button data-action="steps">Show steps</button>
                <button class="danger" data-action="reveal">Reveal answer</button>
              </div>
              <div class="feedback" aria-live="polite"></div>
              <div class="step hidden"></div>
            </div>

            <div class="calc-box" data-prob="b_mixed">
              <label>β<sub>mixed</sub> = \(\bar Y_{\cdot mixed\cdot} - \bar Y_{\cdot\cdot\cdot}\)</label>
              <input inputmode="decimal" placeholder="e.g., -0.37" />
              <div class="btns">
                <button class="primary" data-action="check">Check</button>
                <button data-action="steps">Show steps</button>
                <button class="danger" data-action="reveal">Reveal answer</button>
              </div>
              <div class="feedback" aria-live="polite"></div>
              <div class="step hidden"></div>
            </div>

            <div class="calc-box" data-prob="ab_right_mixed">
              <label>(αβ)<sub>right,mixed</sub> = \(\bar Y_{right,mixed\cdot} - \bar Y_{right\cdot\cdot} - \bar Y_{\cdot mixed\cdot} + \bar Y_{\cdot\cdot\cdot}\)</label>
              <input inputmode="decimal" placeholder="e.g., -0.07" />
              <div class="btns">
                <button class="primary" data-action="check">Check</button>
                <button data-action="steps">Show steps</button>
                <button class="danger" data-action="reveal">Reveal answer</button>
              </div>
              <div class="feedback" aria-live="polite"></div>
              <div class="step hidden"></div>
            </div>
          </div>

          <div>
            <details class="pill" open>
              <summary>Show R output (given in SG3)</summary>
              <div class="answer">
                <pre class="rout"><code>em6.damage
##  damagef emmean    SE df lower.CL upper.CL
##  Left      6.17 0.254 15     5.62     6.71
##  Right     7.61 0.254 15     7.07     8.15
##  Control   8.67 0.254 15     8.12     9.21
##
## Results are averaged over the levels of: stimuli
## Confidence level used: 0.95

em6.stimuli
##  stimuli emmean    SE df lower.CL upper.CL
##  digits    8.06 0.218 15     7.59     8.52
##  letters   7.28 0.259 15     6.72     7.83
##  mixed     7.11 0.251 15     6.58     7.65
##
## Results are averaged over the levels of: damagef
## Confidence level used: 0.95

em6.cell
##  damagef stimuli emmean    SE df lower.CL upper.CL
##  Left    digits    7.00 0.378 15     6.20     7.80
##  Right   digits    8.17 0.378 15     7.36     8.97
##  Control digits    9.00 0.378 15     8.20     9.80
##  Left    letters   5.67 0.449 15     4.71     6.62
##  Right   letters   7.50 0.449 15     6.54     8.46
##  Control letters   8.67 0.449 15     7.71     9.62
##  Left    mixed     5.83 0.435 15     4.91     6.76
##  Right   mixed     7.17 0.435 15     6.24     8.09
##  Control mixed     8.33 0.435 15     7.41     9.26
##
## Confidence level used: 0.95</code></pre>
              </div>
            </details>
          </div>
        </div>
      </div>

      <div>
        <div class="panel">
          <h4>Quick sanity check (what you should see)</h4>
          <ul>
            <li>Right mean is slightly above the grand mean → α<sub>right</sub> should be small positive.</li>
            <li>Mixed mean is below the grand mean → β<sub>mixed</sub> should be negative.</li>
            <li>Right×Mixed cell is close to what main effects predict → interaction cell effect should be near 0.</li>
          </ul>
        </div>
      </div>
    </div>
  </section>

  <!-- 6b -->
  <section class="card" id="p6b">
    <h2>6b — Fill in the ANOVA table (you fill; app checks)</h2>
    <div class="panel">
      <h4>Prompt (SG3)</h4>
      <p>Fill in this ANOVA table. Given SS: Damage=57; Stimuli=9; Subject=17.4; Damage×Stimuli=2; Subject×Stimuli=30.6</p>
    </div>

    <div class="panel">
      <h4>Mini-lesson (short): which MS is the denominator?</h4>
      <ul>
        <li><strong>Damage (between-subject)</strong> uses <strong>Subjects within Damage</strong> as the error term.</li>
        <li><strong>Stimuli</strong> and <strong>Damage×Stimuli</strong> (within-subject) use <strong>Stimuli×Subjects within Damage</strong> as the error term.</li>
      </ul>
    </div>

    <div class="card" style="border-radius:12px;">
      <h3>ANOVA table — enter df, MS, F</h3>
      <p class="muted" style="margin-top:0;">Type your values and click <strong>Check all</strong>. You can reveal the key if you get stuck.</p>

      <div class="btns">
        <button class="primary" id="check-6b">Check all</button>
        <button id="reveal-6b" class="danger">Reveal key</button>
        <button id="reset-6b">Reset</button>
      </div>
      <div id="fb-6b" class="feedback" aria-live="polite"></div>

      <table class="tbl" id="anova-6b">
        <thead>
          <tr>
            <th>Source</th>
            <th class="right">SS (given)</th>
            <th class="center">df</th>
            <th class="center">MS</th>
            <th class="center">F</th>
          </tr>
        </thead>
        <tbody>
          <tr data-row="A">
            <td>Damage (A)</td>
            <td class="right">57.0</td>
            <td><input data-field="df" placeholder="?" /></td>
            <td><input data-field="ms" placeholder="?" /></td>
            <td><input data-field="f" placeholder="?" /></td>
          </tr>
          <tr data-row="SA">
            <td>Subjects within Damage, S(A)</td>
            <td class="right">17.4</td>
            <td><input data-field="df" placeholder="?" /></td>
            <td><input data-field="ms" placeholder="?" /></td>
            <td class="center muted">—</td>
          </tr>
          <tr data-row="B">
            <td>Stimuli (B)</td>
            <td class="right">9.0</td>
            <td><input data-field="df" placeholder="?" /></td>
            <td><input data-field="ms" placeholder="?" /></td>
            <td><input data-field="f" placeholder="?" /></td>
          </tr>
          <tr data-row="BSA">
            <td>B×S(A) (within error)</td>
            <td class="right">30.6</td>
            <td><input data-field="df" placeholder="?" /></td>
            <td><input data-field="ms" placeholder="?" /></td>
            <td class="center muted">—</td>
          </tr>
          <tr data-row="AB">
            <td>Damage×Stimuli (A×B)</td>
            <td class="right">2.0</td>
            <td><input data-field="df" placeholder="?" /></td>
            <td><input data-field="ms" placeholder="?" /></td>
            <td><input data-field="f" placeholder="?" /></td>
          </tr>
        </tbody>
      </table>

      <details class="pill">
        <summary>Show full key (filled table + how the denominators work)</summary>
        <div class="answer">
          <p><strong>Key df:</strong> A:2; S(A):15; B:2; B×S(A):30; A×B:4.</p>
          <p><strong>Key MS:</strong> MS<sub>A</sub>=28.50; MS<sub>S(A)</sub>=1.16; MS<sub>B</sub>=4.50; MS<sub>B×S(A)</sub>=1.02; MS<sub>AB</sub>=0.50.</p>
          <p><strong>Key F:</strong> F<sub>A</sub>=24.57 (denom MS<sub>S(A)</sub>); F<sub>B</sub>=4.41 (denom MS<sub>B×S(A)</sub>); F<sub>AB</sub>=0.49 (denom MS<sub>B×S(A)</sub>).</p>
        </div>
      </details>
    </div>
  </section>

  <!-- 6c -->
  <section class="card" id="p6c">
    <h2>6c — Contrasts (type, null, adjustment, interpret)</h2>
    <div class="panel">
      <h4>Prompt (SG3)</h4>
      <p>For each contrast: (a) identify the type of contrast; (b) write the null hypothesis that contrast is testing; (c) calculate the appropriate posthoc-adjusted critical value; and (d) interpret the contrast, including directionality. Use the Tukey adjustment for pairwise contrasts; use the Scheffe adjustment for complex contrasts.</p>
    </div>

    <div class="panel">
      <h4>Mini-lesson (short): what are you doing in 6c?</h4>
      <ol>
        <li>Translate the contrast vector into an English comparison.</li>
        <li>Write the null hypothesis for that comparison.</li>
        <li>Pick Tukey (pairwise) or Scheffé (complex), then get the adjusted critical value.</li>
        <li>Use the SG3 t.ratio + sign to decide significance + direction.</li>
      </ol>
    </div>

    <details class="pill" open>
      <summary>Show R output (given in SG3)</summary>
      <div class="answer">
        <pre class="rout"><code>contrast(em6.damage, damage6.list)
##  contrast    estimate    SE df t.ratio p.value
##  c(-2, 1, 1)     3.94 0.623 15   6.335 <0.0001
##
## Results are averaged over the levels of: stimuli

contrast(em6.stimuli, stimuli6.list)
##  contrast    estimate    SE df t.ratio p.value
##  c(1, 0, -1)    0.944 0.311 15   3.034  0.0084
##
## Results are averaged over the levels of: damagef

contrast(em6.cell, cell6.list)
##  contrast                        estimate    SE df t.ratio p.value
##  c(-2, 1, 1, 0, 0, 0, 0, 0, 0)      3.167 0.925 15   3.424  0.0038
##  c(0, 0, 0, 0, 0, 0, -2, 1, 1)      3.833 1.060 15   3.601  0.0026
##  c(-2, 1, 1, 0, 0, 0, 2, -1, -1)   -0.667 1.320 15  -0.505  0.6211</code></pre>
      </div>
    </details>

    <div class="card" style="border-radius:12px;">
      <h3>Contrast cards — you decide (type → null → critical value → interpret)</h3>
      <p class="muted" style="margin-top:0;">For each contrast: pick pairwise vs complex, choose Tukey vs Scheffé, enter the adjusted critical value, then decide significance and direction. Use the floating calculator.</p>

      <div class="calc-box" data-c6="damage">
        <label>1) Damage contrast: <code>c(-2, 1, 1)</code> (t.ratio = <strong>6.335</strong>, df = 15)</label>
        <div class="grid" style="grid-template-columns:1fr; gap:10px;">
          <div>
            <div class="muted">(a) Type</div>
            <select data-field="type">
              <option value="">Select…</option>
              <option value="pairwise">Pairwise</option>
              <option value="complex">Complex</option>
            </select>
          </div>
          <div>
            <div class="muted">(b) Null hypothesis</div>
            <select data-field="null">
              <option value="">Select…</option>
              <option value="L_eq_avgRC">\(H_0: \mu_L = (\mu_R + \mu_C)/2\)</option>
              <option value="R_eq_C">\(H_0: \mu_R = \mu_C\)</option>
              <option value="avgRC_eq_0">\(H_0: (\mu_R + \mu_C)/2 = 0\)</option>
            </select>
          </div>
          <div>
            <div class="muted">(c) Adjustment</div>
            <select data-field="adj">
              <option value="">Select…</option>
              <option value="tukey">Tukey</option>
              <option value="scheffe">Scheffé</option>
            </select>
          </div>
          <div>
            <div class="muted">Enter adjusted critical value (t*)</div>
            <input data-field="crit" inputmode="decimal" placeholder="e.g., 2.71" />
          </div>
          <div>
            <div class="muted">(d) Significant?</div>
            <select data-field="sig">
              <option value="">Select…</option>
              <option value="sig">Significant</option>
              <option value="ns">Not significant</option>
            </select>
          </div>
          <div>
            <div class="muted">Direction (based on estimate = +3.94)</div>
            <select data-field="dir">
              <option value="">Select…</option>
              <option value="avgRC_gt_L">Average(Right,Control) &gt; Left</option>
              <option value="L_gt_avgRC">Left &gt; Average(Right,Control)</option>
              <option value="no_dir">No direction / cannot tell</option>
            </select>
          </div>
        </div>
        <div class="btns">
          <button class="primary" data-action="check">Check</button>
          <button class="danger" data-action="reveal">Reveal key</button>
        </div>
        <div class="feedback" aria-live="polite"></div>
      </div>

      <div class="calc-box" data-c6="stimuli">
        <label>2) Stimuli contrast: <code>c(1, 0, -1)</code> (t.ratio = <strong>3.034</strong>, df = 15)</label>
        <div class="grid" style="grid-template-columns:1fr; gap:10px;">
          <div>
            <div class="muted">(a) Type</div>
            <select data-field="type">
              <option value="">Select…</option>
              <option value="pairwise">Pairwise</option>
              <option value="complex">Complex</option>
            </select>
          </div>
          <div>
            <div class="muted">(b) Null hypothesis</div>
            <select data-field="null">
              <option value="">Select…</option>
              <option value="dig_eq_mix">\(H_0: \mu_{digits} - \mu_{mixed} = 0\)</option>
              <option value="dig_eq_let">\(H_0: \mu_{digits} - \mu_{letters} = 0\)</option>
              <option value="mix_eq_let">\(H_0: \mu_{mixed} - \mu_{letters} = 0\)</option>
            </select>
          </div>
          <div>
            <div class="muted">(c) Adjustment</div>
            <select data-field="adj">
              <option value="">Select…</option>
              <option value="tukey">Tukey</option>
              <option value="scheffe">Scheffé</option>
            </select>
          </div>
          <div>
            <div class="muted">Enter adjusted critical value (t*)</div>
            <input data-field="crit" inputmode="decimal" placeholder="e.g., 2.60" />
          </div>
          <div>
            <div class="muted">(d) Significant?</div>
            <select data-field="sig">
              <option value="">Select…</option>
              <option value="sig">Significant</option>
              <option value="ns">Not significant</option>
            </select>
          </div>
          <div>
            <div class="muted">Direction (based on estimate = +0.944)</div>
            <select data-field="dir">
              <option value="">Select…</option>
              <option value="dig_gt_mix">Digits &gt; Mixed</option>
              <option value="mix_gt_dig">Mixed &gt; Digits</option>
              <option value="no_dir">No direction / cannot tell</option>
            </select>
          </div>
        </div>
        <div class="btns">
          <button class="primary" data-action="check">Check</button>
          <button class="danger" data-action="reveal">Reveal key</button>
        </div>
        <div class="feedback" aria-live="polite"></div>
      </div>

      <div class="calc-box" data-c6="cell_digits">
        <label>3) Cell contrast (Digits simple effect of damage): <code>c(-2,1,1, 0,0,0, 0,0,0)</code> (t.ratio = <strong>3.424</strong>, df = 15)</label>
        <div class="grid" style="grid-template-columns:1fr; gap:10px;">
          <div>
            <div class="muted">(a) Type</div>
            <select data-field="type"><option value="">Select…</option><option value="pairwise">Pairwise</option><option value="complex">Complex</option></select>
          </div>
          <div>
            <div class="muted">(b) Null hypothesis</div>
            <select data-field="null">
              <option value="">Select…</option>
              <option value="L_eq_avgRC_digits">\(H_0: \mu_{L,digits} = (\mu_{R,digits}+\mu_{C,digits})/2\)</option>
              <option value="R_eq_C_digits">\(H_0: \mu_{R,digits} = \mu_{C,digits}\)</option>
              <option value="dig_eq_mix_any">\(H_0: \mu_{digits} = \mu_{mixed}\)</option>
            </select>
          </div>
          <div>
            <div class="muted">(c) Adjustment</div>
            <select data-field="adj"><option value="">Select…</option><option value="tukey">Tukey</option><option value="scheffe">Scheffé</option></select>
          </div>
          <div>
            <div class="muted">Enter adjusted critical value (t*)</div>
            <input data-field="crit" inputmode="decimal" placeholder="e.g., 2.71" />
          </div>
          <div>
            <div class="muted">(d) Significant?</div>
            <select data-field="sig"><option value="">Select…</option><option value="sig">Significant</option><option value="ns">Not significant</option></select>
          </div>
          <div>
            <div class="muted">Direction (estimate = +3.167)</div>
            <select data-field="dir"><option value="">Select…</option><option value="avgRC_gt_L">Avg(R,C) &gt; L (within digits)</option><option value="L_gt_avgRC">L &gt; Avg(R,C) (within digits)</option><option value="no_dir">No direction</option></select>
          </div>
        </div>
        <div class="btns"><button class="primary" data-action="check">Check</button><button class="danger" data-action="reveal">Reveal key</button></div>
        <div class="feedback" aria-live="polite"></div>
      </div>

      <div class="calc-box" data-c6="cell_mixed">
        <label>4) Cell contrast (Mixed simple effect of damage): <code>c(0,0,0, 0,0,0, -2,1,1)</code> (t.ratio = <strong>3.601</strong>, df = 15)</label>
        <div class="grid" style="grid-template-columns:1fr; gap:10px;">
          <div><div class="muted">(a) Type</div><select data-field="type"><option value="">Select…</option><option value="pairwise">Pairwise</option><option value="complex">Complex</option></select></div>
          <div><div class="muted">(b) Null hypothesis</div>
            <select data-field="null">
              <option value="">Select…</option>
              <option value="L_eq_avgRC_mixed">\(H_0: \mu_{L,mixed} = (\mu_{R,mixed}+\mu_{C,mixed})/2\)</option>
              <option value="R_eq_C_mixed">\(H_0: \mu_{R,mixed} = \mu_{C,mixed}\)</option>
              <option value="dig_eq_mix_any">\(H_0: \mu_{digits} = \mu_{mixed}\)</option>
            </select>
          </div>
          <div><div class="muted">(c) Adjustment</div><select data-field="adj"><option value="">Select…</option><option value="tukey">Tukey</option><option value="scheffe">Scheffé</option></select></div>
          <div><div class="muted">Enter adjusted critical value (t*)</div><input data-field="crit" inputmode="decimal" placeholder="e.g., 2.71" /></div>
          <div><div class="muted">(d) Significant?</div><select data-field="sig"><option value="">Select…</option><option value="sig">Significant</option><option value="ns">Not significant</option></select></div>
          <div><div class="muted">Direction (estimate = +3.833)</div><select data-field="dir"><option value="">Select…</option><option value="avgRC_gt_L">Avg(R,C) &gt; L (within mixed)</option><option value="L_gt_avgRC">L &gt; Avg(R,C) (within mixed)</option><option value="no_dir">No direction</option></select></div>
        </div>
        <div class="btns"><button class="primary" data-action="check">Check</button><button class="danger" data-action="reveal">Reveal key</button></div>
        <div class="feedback" aria-live="polite"></div>
      </div>

      <div class="calc-box" data-c6="interaction">
        <label>5) Interaction-style contrast (difference of simple effects): <code>c(-2,1,1, 0,0,0, 2,-1,-1)</code> (t.ratio = <strong>-0.505</strong>, df = 15)</label>
        <div class="grid" style="grid-template-columns:1fr; gap:10px;">
          <div><div class="muted">(a) Type</div><select data-field="type"><option value="">Select…</option><option value="pairwise">Pairwise</option><option value="complex">Complex</option></select></div>
          <div><div class="muted">(b) Null hypothesis</div>
            <select data-field="null">
              <option value="">Select…</option>
              <option value="diffdiff_0">\(H_0: [\mu_{L,digits}-(\mu_{R,digits}+\mu_{C,digits})/2] - [\mu_{L,mixed}-(\mu_{R,mixed}+\mu_{C,mixed})/2] = 0\)</option>
              <option value="L_eq_avgRC_digits">\(H_0: \mu_{L,digits} = (\mu_{R,digits}+\mu_{C,digits})/2\)</option>
              <option value="dig_eq_mix_any">\(H_0: \mu_{digits} = \mu_{mixed}\)</option>
            </select>
          </div>
          <div><div class="muted">(c) Adjustment</div><select data-field="adj"><option value="">Select…</option><option value="tukey">Tukey</option><option value="scheffe">Scheffé</option></select></div>
          <div><div class="muted">Enter adjusted critical value (t*)</div><input data-field="crit" inputmode="decimal" placeholder="e.g., 3.81" /></div>
          <div><div class="muted">(d) Significant?</div><select data-field="sig"><option value="">Select…</option><option value="sig">Significant</option><option value="ns">Not significant</option></select></div>
          <div><div class="muted">Direction (estimate = -0.667)</div><select data-field="dir"><option value="">Select…</option><option value="digits_bigger_simple_effect">Simple-effect difference is larger in digits</option><option value="mixed_bigger_simple_effect">Simple-effect difference is larger in mixed</option><option value="no_dir">No reliable direction (ns)</option></select></div>
        </div>
        <div class="btns"><button class="primary" data-action="check">Check</button><button class="danger" data-action="reveal">Reveal key</button></div>
        <div class="feedback" aria-live="polite"></div>
      </div>

      <details class="pill">
        <summary>Show the “why” (1 screen, not a textbook)</summary>
        <div class="answer">
          <ul>
            <li><strong>Pairwise</strong> means 2 levels directly (e.g., Digits vs Mixed) → <strong>Tukey</strong>.</li>
            <li><strong>Complex</strong> means average-vs-mean or diff-of-diffs → <strong>Scheffé</strong>.</li>
            <li>Decision rule: significant if \(|t| &gt; t^*\). Direction comes from the sign of the <strong>estimate</strong>.</li>
          </ul>
        </div>
      </details>
    </div>
  </section>

</div>

<!-- Floating R output (always available) -->
<div id="floatROut" aria-label="Floating R output">
  <header>
    <div class="title">SG3 R output</div>
    <div style="display:flex; gap:6px;">
      <button id="routMin" title="Minimize">Hide</button>
    </div>
  </header>
  <div class="body" id="routBody">
    <div class="tabs" role="tablist" aria-label="R output tabs">
      <button class="rtab" data-tab="rout6a" aria-pressed="true">6a means</button>
      <button class="rtab" data-tab="rout6c" aria-pressed="false">6c contrasts</button>
    </div>
    <div id="rout6a" class="rpanel">
      <pre><code>Grand mean (given): <span class="pick" data-pick="ybar_grand">7.48</span>

em6.damage
##  damagef emmean    SE df lower.CL upper.CL
##  Left      6.17 0.254 15     5.62     6.71
##  Right     <span class="pick" data-pick="ybar_right">7.61</span> 0.254 15     7.07     8.15
##  Control   8.67 0.254 15     8.12     9.21
##
## Results are averaged over the levels of: stimuli
## Confidence level used: 0.95

em6.stimuli
##  stimuli emmean    SE df lower.CL upper.CL
##  digits    8.06 0.218 15     7.59     8.52
##  letters   7.28 0.259 15     6.72     7.83
##  mixed     <span class="pick" data-pick="ybar_mixed">7.11</span> 0.251 15     6.58     7.65
##
## Results are averaged over the levels of: damagef
## Confidence level used: 0.95

em6.cell
##  damagef stimuli emmean    SE df lower.CL upper.CL
##  Left    digits    7.00 0.378 15     6.20     7.80
##  Right   digits    8.17 0.378 15     7.36     8.97
##  Control digits    9.00 0.378 15     8.20     9.80
##  Left    letters   5.67 0.449 15     4.71     6.62
##  Right   letters   7.50 0.449 15     6.54     8.46
##  Control letters   8.67 0.449 15     7.71     9.62
##  Left    mixed     5.83 0.435 15     4.91     6.76
##  Right   mixed     <span class="pick" data-pick="ybar_cell_right_mixed">7.17</span> 0.435 15     6.24     8.09
##  Control mixed     8.33 0.435 15     7.41     9.26
##
## Confidence level used: 0.95</code></pre>
    </div>
    <div id="rout6c" class="rpanel" style="display:none;">
      <pre><code>contrast(em6.damage, damage6.list)
##  contrast    estimate    SE df t.ratio p.value
##  c(-2, 1, 1)     3.94 0.623 15   6.335 <0.0001
##
## Results are averaged over the levels of: stimuli

contrast(em6.stimuli, stimuli6.list)
##  contrast    estimate    SE df t.ratio p.value
##  c(1, 0, -1)    0.944 0.311 15   3.034  0.0084
##
## Results are averaged over the levels of: damagef

contrast(em6.cell, cell6.list)
##  contrast                        estimate    SE df t.ratio p.value
##  c(-2, 1, 1, 0, 0, 0, 0, 0, 0)      3.167 0.925 15   3.424  0.0038
##  c(0, 0, 0, 0, 0, 0, -2, 1, 1)      3.833 1.060 15   3.601  0.0026
##  c(-2, 1, 1, 0, 0, 0, 2, -1, -1)   -0.667 1.320 15  -0.505  0.6211</code></pre>
    </div>
    <div class="mini">This panel floats above everything so you can peek while filling cards/tables.</div>
  </div>
</div>

<!-- Floating Calculator (always available) -->
<div id="floatCalc" aria-label="Floating calculator">
  <header>
    <div class="title">Calculator</div>
    <div style="display:flex; gap:6px;">
      <button id="calcMin" title="Minimize">Hide</button>
      <button id="calcClr" title="Clear">Clear</button>
    </div>
  </header>
  <div class="body" id="calcBody">
    <div class="row">
      <input id="calcExpr" placeholder="Type an expression, e.g., 7.61 - 7.48" />
      <button class="primary" id="calcGo">=</button>
    </div>
    <div class="mini">Tip: click the insert buttons to drop unlocked means into the expression.</div>
    <div class="keys">
      <button class="ins" data-ins="ybar_right">Insert \(\bar Y_{right\cdot\cdot}\)</button>
      <button class="ins" data-ins="ybar_mixed">Insert \(\bar Y_{\cdot mixed\cdot}\)</button>
      <button class="ins" data-ins="ybar_cell_right_mixed">Insert \(\bar Y_{right,mixed\cdot}\)</button>
      <button class="ins" data-ins="ybar_grand">Insert \(\bar Y_{\cdot\cdot\cdot}\)</button>
      <button data-key="+">+</button>
      <button data-key="-">−</button>
      <button data-key="*">×</button>
      <button data-key="/">÷</button>
      <button data-key="(">(</button>
      <button data-key=")">)</button>
      <button data-key="^">^</button>
    </div>
    <div class="out" id="calcOut">Result: —</div>
  </div>
</div>

<script>
  // ------------------------------
  // Utilities
  // ------------------------------
  function toNum(s){
    if (s === null || s === undefined) return null;
    const x = String(s).trim().replace(/,/g,'');
    if (x==='') return null;
    const v = Number(x);
    return Number.isFinite(v) ? v : null;
  }
  function closeEnough(a,b,tol=0.02){
    return Math.abs(a-b) <= tol;
  }

  // ------------------------------
  // 6a chips + calculators
  // ------------------------------
  const means6a = {
    grand: 7.48,
    right: 7.61,
    mixed: 7.11,
    cell_right_mixed: 7.17,
  };

  const expected6a = {
    a_right: { value: +(means6a.right - means6a.grand).toFixed(2), steps: () => `α_right = Ȳ_right − Ȳ... = ${means6a.right} − ${means6a.grand} = ${(means6a.right-means6a.grand).toFixed(2)}` },
    b_mixed: { value: +(means6a.mixed - means6a.grand).toFixed(2), steps: () => `β_mixed = Ȳ_mixed − Ȳ... = ${means6a.mixed} − ${means6a.grand} = ${(means6a.mixed-means6a.grand).toFixed(2)}` },
    ab_right_mixed: {
      value: +(means6a.cell_right_mixed - means6a.right - means6a.mixed + means6a.grand).toFixed(2),
      steps: () => `αβ_right,mixed = Ȳ_right,mixed − Ȳ_right − Ȳ_mixed + Ȳ... = ${means6a.cell_right_mixed} − ${means6a.right} − ${means6a.mixed} + ${means6a.grand} = ${(means6a.cell_right_mixed - means6a.right - means6a.mixed + means6a.grand).toFixed(2)}`
    }
  };

  const unlocked6a = { ybar_right:false, ybar_mixed:false, ybar_cell_right_mixed:false, ybar_grand:false };

  function renderChips6a(){
    const el = document.getElementById('chips-6a');
    if (!el) return;
    const chips = [];
    if (unlocked6a.ybar_grand) chips.push(`<div class="chip grand"><small>\(\\bar Y_{\\cdot\\cdot\\cdot}\\)</small>${means6a.grand}</div>`);
    if (unlocked6a.ybar_right) chips.push(`<div class="chip right"><small>\(\\bar Y_{right\\cdot\\cdot}\\)</small>${means6a.right}</div>`);
    if (unlocked6a.ybar_mixed) chips.push(`<div class="chip mixed"><small>\(\\bar Y_{\\cdot mixed\\cdot}\\)</small>${means6a.mixed}</div>`);
    if (unlocked6a.ybar_cell_right_mixed) chips.push(`<div class="chip cell"><small>\(\\bar Y_{right,mixed\\cdot}\\)</small>${means6a.cell_right_mixed}</div>`);

    if (chips.length === 0){
      el.style.display = 'none';
      el.innerHTML = '';
    } else {
      el.style.display = 'flex';
      el.innerHTML = chips.join('');
      // re-typeset math in chips
      if (window.MathJax && window.MathJax.typesetPromise) {
        window.MathJax.typesetPromise([el]).catch(()=>{});
      }
    }
  }

  (function initMap6a(){
    const fb = document.getElementById('mapfb-6a');
    const table = document.getElementById('map-6a');
    if (!table) return;

    let activeTarget = null;

    function setMsg(ok, msg){
      fb.textContent = msg;
      fb.className = 'feedback ' + (ok ? 'ok' : 'no');
    }

    function setStatus(key, ok){
      const s = table.querySelector(`[data-status="${key}"]`);
      if (!s) return;
      s.textContent = ok ? 'unlocked' : 'locked';
      s.className = 'status ' + (ok ? 'ok' : 'lock');
    }

    function activate(key){
      activeTarget = key;
      // switch floating output to 6a tab so it's in your face
      const btn = document.querySelector('#routBody .rtab[data-tab="rout6a"]');
      btn?.click?.();
      setMsg(true, `Now click the correct number in the floating R output for ${key}.`);
      document.querySelectorAll('.pick').forEach(p => p.classList.remove('active','wrong'));
      // highlight all pickables to guide attention
      document.querySelectorAll('.pick').forEach(p => p.classList.add('active'));
    }

    table.querySelectorAll('button[data-action="select"]').forEach(btn => {
      btn.addEventListener('click', () => activate(btn.getAttribute('data-target')));
    });

    // click a number in floating output
    document.querySelectorAll('.pick[data-pick]').forEach(p => {
      p.addEventListener('click', () => {
        const picked = p.getAttribute('data-pick');
        if (!activeTarget){
          setMsg(false, 'Click “Select in output” for a symbol first.');
          p.classList.add('wrong');
          return;
        }
        if (picked !== activeTarget){
          setMsg(false, 'Wrong number for the active symbol. Try again.');
          p.classList.add('wrong');
          return;
        }

        // unlock the right chip
        unlocked6a[picked] = true;
        setStatus(picked, true);
        renderChips6a();
        setMsg(true, 'Unlocked. Now compute the effect below.');
        activeTarget = null;
        document.querySelectorAll('.pick').forEach(x => x.classList.remove('active','wrong'));
      });
    });

    // initial statuses
    Object.keys(unlocked6a).forEach(k => setStatus(k, false));

  })();

  // initial render (hidden)
  renderChips6a();

  // Expose unlocked means to the floating calculator
  window.__means6a = means6a;
  window.__unlocked6a = unlocked6a;

  (function init6a(){
    document.querySelectorAll('.calc-box[data-prob]').forEach(box => {
      const key = box.getAttribute('data-prob');
      const input = box.querySelector('input');
      const fb = box.querySelector('.feedback');
      const step = box.querySelector('.step');
      const exp = expected6a[key];

      function setFeedback(ok, msg){
        fb.textContent = msg;
        fb.className = 'feedback ' + (ok ? 'ok' : 'no');
      }

      box.querySelectorAll('button[data-action]').forEach(btn => {
        btn.addEventListener('click', () => {
          const action = btn.getAttribute('data-action');
          if (action === 'check'){
            const v = toNum(input.value);
            if (v === null){
              setFeedback(false, 'Enter a number first.');
              return;
            }
            if (closeEnough(v, exp.value)) setFeedback(true, 'Correct.');
            else setFeedback(false, `Not quite. (Your: ${v}; expected is near ${exp.value})`);
          }
          if (action === 'steps'){
            step.classList.toggle('hidden');
            step.textContent = exp.steps();
          }
          if (action === 'reveal'){
            input.value = exp.value.toFixed(2);
            setFeedback(true, `Revealed: ${exp.value.toFixed(2)}`);
          }
        });
      });
    });
  })();

  // ------------------------------
  // 6c: Contrast cards checks
  // ------------------------------
  const expected6c = {
    damage: {
      type:'complex', null:'L_eq_avgRC', adj:'scheffe', crit:2.7138,
      sig:'sig', dir:'avgRC_gt_L'
    },
    stimuli: {
      type:'pairwise', null:'dig_eq_mix', adj:'tukey', crit:2.5975,
      sig:'sig', dir:'dig_gt_mix'
    },
    cell_digits: {
      type:'complex', null:'L_eq_avgRC_digits', adj:'scheffe', crit:2.7138,
      sig:'sig', dir:'avgRC_gt_L'
    },
    cell_mixed: {
      type:'complex', null:'L_eq_avgRC_mixed', adj:'scheffe', crit:2.7138,
      sig:'sig', dir:'avgRC_gt_L'
    },
    interaction: {
      type:'complex', null:'diffdiff_0', adj:'scheffe', crit:3.8087,
      sig:'ns', dir:'no_dir'
    }
  };

  const tRatios6c = {
    damage: 6.335,
    stimuli: 3.034,
    cell_digits: 3.424,
    cell_mixed: 3.601,
    interaction: -0.505
  };

  (function init6c(){
    document.querySelectorAll('.calc-box[data-c6]').forEach(card => {
      const key = card.getAttribute('data-c6');
      const exp = expected6c[key];
      if (!exp) return;
      const fb = card.querySelector('.feedback');

      function setMsg(ok, msg){
        fb.textContent = msg;
        fb.className = 'feedback ' + (ok ? 'ok' : 'no');
      }

      function get(field){
        const el = card.querySelector(`[data-field="${field}"]`);
        return el ? el.value : '';
      }

      function set(field, value){
        const el = card.querySelector(`[data-field="${field}"]`);
        if (el) el.value = value;
      }

      function check(){
        let okAll = true;
        const problems = [];

        const type = get('type');
        const nul = get('null');
        const adj = get('adj');
        const crit = toNum(get('crit'));
        const sig = get('sig');
        const dir = get('dir');

        if (type !== exp.type){ okAll=false; problems.push('type'); }
        if (nul !== exp.null){ okAll=false; problems.push('null'); }
        if (adj !== exp.adj){ okAll=false; problems.push('adjustment'); }
        if (crit === null){ okAll=false; problems.push('critical value (blank)'); }
        else if (!closeEnough(crit, exp.crit, 0.06)) { okAll=false; problems.push(`critical value (expected ≈ ${exp.crit.toFixed(2)})`); }

        // significance can be inferred from your crit + |t|
        if (crit !== null){
          const t = Math.abs(tRatios6c[key]);
          const inferred = (t > crit) ? 'sig' : 'ns';
          if (sig && sig !== inferred){ okAll=false; problems.push('significance'); }
        } else {
          if (sig !== exp.sig){ okAll=false; problems.push('significance'); }
        }

        if (dir !== exp.dir){ okAll=false; problems.push('direction'); }

        if (okAll) setMsg(true, 'Correct.');
        else setMsg(false, 'Fix: ' + problems.join(', '));
      }

      function reveal(){
        set('type', exp.type);
        set('null', exp.null);
        set('adj', exp.adj);
        set('crit', exp.crit.toFixed(2));
        set('sig', exp.sig);
        set('dir', exp.dir);
        setMsg(true, 'Key revealed.');
      }

      card.querySelectorAll('button[data-action]').forEach(b => {
        b.addEventListener('click', () => {
          const a = b.getAttribute('data-action');
          if (a === 'check') check();
          if (a === 'reveal') reveal();
        });
      });
    });
  })();

  // ------------------------------
  // 6b: ANOVA table checks
  // ------------------------------
  const expected6b = {
    A:  { df:2,  ms:28.50, f:24.57 },
    SA: { df:15, ms:1.16 },
    B:  { df:2,  ms:4.50,  f:4.41 },
    BSA:{ df:30, ms:1.02 },
    AB: { df:4,  ms:0.50,  f:0.49 },
  };

  function getRow(rowKey){
    return document.querySelector(`#anova-6b tr[data-row="${rowKey}"]`);
  }

  function checkCell(input, expected, tol){
    const v = toNum(input.value);
    if (v === null) return { ok:false, msg:'blank' };
    const ok = closeEnough(v, expected, tol);
    return { ok, msg: ok ? 'ok' : `exp≈${expected}` };
  }

  (function initFloatROut(){
    const box = document.getElementById('floatROut');
    const body = document.getElementById('routBody');
    const min = document.getElementById('routMin');
    if (!box || !body || !min) return;

    function showTab(id){
      body.querySelectorAll('.rpanel').forEach(p => p.style.display = (p.id === id) ? 'block' : 'none');
      body.querySelectorAll('.rtab').forEach(b => b.setAttribute('aria-pressed', String(b.getAttribute('data-tab') === id)));
    }

    body.querySelectorAll('.rtab').forEach(b => {
      b.addEventListener('click', () => showTab(b.getAttribute('data-tab')));
    });

    min.addEventListener('click', () => {
      const hidden = body.style.display === 'none';
      body.style.display = hidden ? 'block' : 'none';
      min.textContent = hidden ? 'Hide' : 'Show';
    });
  })();

  (function initFloatCalc(){
    const box = document.getElementById('floatCalc');
    const body = document.getElementById('calcBody');
    const expr = document.getElementById('calcExpr');
    const out = document.getElementById('calcOut');
    const go = document.getElementById('calcGo');
    const min = document.getElementById('calcMin');
    const clr = document.getElementById('calcClr');
    if (!box || !expr || !out) return;

    function showResult(msg, ok=true){
      out.textContent = msg;
      out.style.borderColor = ok ? '#cfe3ea' : '#fecaca';
      out.style.background = ok ? '#fcfeff' : '#fff1f2';
    }

    function evalExpr(raw){
      // tiny safe-ish evaluator: digits, ops, parentheses, decimal points, spaces
      let s = String(raw || '').trim();
      if (!s) return null;
      s = s.replace(/×/g,'*').replace(/÷/g,'/');
      // exponent
      s = s.replace(/\^/g,'**');
      if (!/^[0-9+\-*/().\s*]*$/.test(s)) throw new Error('Only numbers and + - * / ( ) ^ allowed');
      // eslint-disable-next-line no-new-func
      const v = Function(`"use strict"; return (${s});`)();
      if (!Number.isFinite(v)) throw new Error('Result is not finite');
      return v;
    }

    function insertText(t){
      const start = expr.selectionStart ?? expr.value.length;
      const end = expr.selectionEnd ?? expr.value.length;
      const before = expr.value.slice(0,start);
      const after = expr.value.slice(end);
      expr.value = before + t + after;
      expr.focus();
      const pos = start + String(t).length;
      expr.setSelectionRange(pos,pos);
    }

    function getUnlockedValue(key){
      const means = window.__means6a || {};
      const unlocked = window.__unlocked6a || {};
      if (key === 'ybar_right' && unlocked.ybar_right) return means.right;
      if (key === 'ybar_mixed' && unlocked.ybar_mixed) return means.mixed;
      if (key === 'ybar_cell_right_mixed' && unlocked.ybar_cell_right_mixed) return means.cell_right_mixed;
      if (key === 'ybar_grand' && unlocked.ybar_grand) return means.grand;
      return null;
    }

    function updateInsertButtons(){
      box.querySelectorAll('button[data-ins]').forEach(b => {
        const k = b.getAttribute('data-ins');
        const v = getUnlockedValue(k);
        b.disabled = (v === null);
        b.style.opacity = b.disabled ? .45 : 1;
      });
    }

    go?.addEventListener('click', () => {
      try{
        const v = evalExpr(expr.value);
        if (v === null) return;
        showResult(`Result: ${v}`);
      } catch(e){
        showResult(`Error: ${e.message}`, false);
      }
    });
    expr.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') go.click();
    });

    box.querySelectorAll('button[data-key]').forEach(b => {
      b.addEventListener('click', () => insertText(b.getAttribute('data-key')));
    });
    box.querySelectorAll('button[data-ins]').forEach(b => {
      b.addEventListener('click', () => {
        const k = b.getAttribute('data-ins');
        const v = getUnlockedValue(k);
        if (v === null){
          showResult('Unlock that mean first in 6a (mapping table).', false);
          return;
        }
        insertText(String(v));
      });
    });

    clr?.addEventListener('click', () => {
      expr.value = '';
      showResult('Result: —');
      expr.focus();
    });

    min?.addEventListener('click', () => {
      const hidden = body.style.display === 'none';
      body.style.display = hidden ? 'block' : 'none';
      min.textContent = hidden ? 'Hide' : 'Show';
    });

    // refresh buttons periodically (cheap + robust)
    updateInsertButtons();
    setInterval(updateInsertButtons, 600);
  })();

  (function init6b(){
    const fb = document.getElementById('fb-6b');
    const checkBtn = document.getElementById('check-6b');
    const revealBtn = document.getElementById('reveal-6b');
    const resetBtn = document.getElementById('reset-6b');

    // Expose to calculator (6b pieces)
    window.__anova6b = {
      ss_A:57.0, ss_SA:17.4, ss_B:9.0, ss_BSA:30.6, ss_AB:2.0,
      df_A:2, df_SA:15, df_B:2, df_BSA:30, df_AB:4,
      ms_A:28.50, ms_SA:1.16, ms_B:4.50, ms_BSA:1.02, ms_AB:0.50,
      f_A:24.57, f_B:4.41, f_AB:0.49
    };

    // keep calculator values in sync if user reveals the key
    function refreshCalcFromInputs(){
      try{
        const tbl = document.getElementById('anova-6b');
        if (!tbl) return;
        const get = (row, field) => {
          const tr = tbl.querySelector(`tr[data-row="${row}"]`);
          const inp = tr?.querySelector(`input[data-field="${field}"]`);
          return inp ? toNum(inp.value) : null;
        };
        const dfA=get('A','df'), msA=get('A','ms'), fA=get('A','f');
        const dfSA=get('SA','df'), msSA=get('SA','ms');
        const dfB=get('B','df'), msB=get('B','ms'), fB=get('B','f');
        const dfBSA=get('BSA','df'), msBSA=get('BSA','ms');
        const dfAB=get('AB','df'), msAB=get('AB','ms'), fAB=get('AB','f');
        if (dfA!=null) window.__anova6b.df_A=dfA;
        if (msA!=null) window.__anova6b.ms_A=msA;
        if (fA!=null) window.__anova6b.f_A=fA;
        if (dfSA!=null) window.__anova6b.df_SA=dfSA;
        if (msSA!=null) window.__anova6b.ms_SA=msSA;
        if (dfB!=null) window.__anova6b.df_B=dfB;
        if (msB!=null) window.__anova6b.ms_B=msB;
        if (fB!=null) window.__anova6b.f_B=fB;
        if (dfBSA!=null) window.__anova6b.df_BSA=dfBSA;
        if (msBSA!=null) window.__anova6b.ms_BSA=msBSA;
        if (dfAB!=null) window.__anova6b.df_AB=dfAB;
        if (msAB!=null) window.__anova6b.ms_AB=msAB;
        if (fAB!=null) window.__anova6b.f_AB=fAB;
      } catch(e){}
    }

    function setMsg(ok, msg){
      fb.textContent = msg;
      fb.className = 'feedback ' + (ok ? 'ok' : 'no');
    }

    function checkAll(){
      let okAll = true;
      let missing = 0;

      ['A','SA','B','BSA','AB'].forEach(k => {
        const tr = getRow(k);
        if (!tr) return;
        const exp = expected6b[k];
        tr.querySelectorAll('input').forEach(inp => {
          inp.style.outline = '';
        });

        // df
        const dfInp = tr.querySelector('input[data-field="df"]');
        if (dfInp){
          const r = checkCell(dfInp, exp.df, 0.01);
          if (r.msg==='blank') missing++;
          if (!r.ok){ okAll=false; dfInp.style.outline='2px solid #fca5a5'; }
          else dfInp.style.outline='2px solid #86efac';
        }

        // ms
        const msInp = tr.querySelector('input[data-field="ms"]');
        if (msInp){
          const r = checkCell(msInp, exp.ms, 0.03);
          if (r.msg==='blank') missing++;
          if (!r.ok){ okAll=false; msInp.style.outline='2px solid #fca5a5'; }
          else msInp.style.outline='2px solid #86efac';
        }

        // f (only for rows with it)
        const fInp = tr.querySelector('input[data-field="f"]');
        if (fInp && exp.f !== undefined){
          const r = checkCell(fInp, exp.f, 0.05);
          if (r.msg==='blank') missing++;
          if (!r.ok){ okAll=false; fInp.style.outline='2px solid #fca5a5'; }
          else fInp.style.outline='2px solid #86efac';
        }
      });

      if (missing>0) setMsg(false, `Some cells are blank (${missing}). Fill them then re-check.`);
      else if (okAll) setMsg(true, 'All correct.');
      else setMsg(false, 'Some entries are off. Red outlines = fix those cells.');
    }

    function reveal(){
      Object.keys(expected6b).forEach(k => {
        const tr = getRow(k);
        if (!tr) return;
        const exp = expected6b[k];
        const dfInp = tr.querySelector('input[data-field="df"]');
        if (dfInp) dfInp.value = exp.df;
        const msInp = tr.querySelector('input[data-field="ms"]');
        if (msInp) msInp.value = exp.ms.toFixed(2);
        const fInp = tr.querySelector('input[data-field="f"]');
        if (fInp && exp.f !== undefined) fInp.value = exp.f.toFixed(2);
      });
      refreshCalcFromInputs();
      setMsg(true, 'Key revealed.');
    }

    function reset(){
      document.querySelectorAll('#anova-6b input').forEach(i => { i.value=''; i.style.outline=''; });
      setMsg(true, 'Reset.');
    }

    checkBtn?.addEventListener('click', checkAll);
    revealBtn?.addEventListener('click', reveal);
    resetBtn?.addEventListener('click', reset);
  })();
</script>

<!-- MathJax -->
<script>
  window.MathJax = {
    tex: {
      inlineMath: [['\\(','\\)'], ['$', '$']],
      displayMath: [['\\[','\\]'], ['$$', '$$']],
      processEscapes: true
    },
    options: { skipHtmlTags: ['script','noscript','style','textarea','pre','code'] }
  };
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

</body>
</html>
