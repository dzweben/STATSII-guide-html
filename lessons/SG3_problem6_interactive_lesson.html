<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<title>SG3 Problem 6 — Interactive App (Split-Plot ANOVA + Contrasts)</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root{
    --ink:#1b1b1b;
    --muted:#5b5b5b;
    --bg:#f7f7f4;
    --card:#ffffff;
    --teal:#0d475c;
    --teal2:#eef6f8;
    --line:#dcdcdc;
    --warn:#fff8e1;
    --warn-border:#d7a34a;
    --good:#0f766e;
    --bad:#b91c1c;

    --c-grand:#111827;
    --c-right:#2563eb;
    --c-mixed:#7c3aed;
    --c-cell:#f59e0b;
  }
  body{font-family: Georgia, serif; margin:0; background:var(--bg); color:var(--ink);}
  header{background:var(--teal); color:#fff; padding:22px 28px;}
  header h1{margin:0 0 6px; font-size:24px;}
  header p{margin:0; opacity:.92; max-width:1100px;}
  .container{max-width:1150px; margin:0 auto; padding:18px 28px 60px;}

  .card{background:var(--card); border:1px solid var(--line); border-radius:14px; padding:14px 16px; margin:14px 0;}
  .panel{border:1px solid var(--warn-border); background:var(--warn); border-radius:10px; padding:12px 14px; margin:10px 0;}
  .panel h4{margin:0 0 6px; color:#8a5a00;}
  h2{margin:6px 0 10px; font-size:20px;}
  h3{margin:10px 0 8px; font-size:16px;}
  .muted{color:var(--muted);} 

  .kpi{display:flex; gap:10px; flex-wrap:wrap;}
  .kpi .pill{background:var(--teal2); border:1px solid #cfe3ea; border-radius:999px; padding:6px 10px; font-weight:700; color:var(--teal);}

  .grid{display:grid; gap:12px; grid-template-columns:1fr;}
  @media (min-width: 980px){ .grid.two{grid-template-columns: 1.2fr .8fr;} }

  details{background:var(--card); border:1px solid var(--line); border-radius:12px; margin:10px 0; padding:10px 12px;}
  summary{font-weight:800; cursor:pointer;}

  details.pill{border:0; padding:0; background:transparent;}
  details.pill > summary{
    display:inline-block; font-size:14px; font-weight:800; color:var(--teal);
    background:var(--teal2); border:1px solid #cfe3ea; border-radius:999px;
    padding:6px 10px; margin:6px 0 0; list-style:none;
  }
  details.pill > summary::-webkit-details-marker{display:none;}
  details.pill .answer{padding:10px 8px; border:1px dashed #cfe3ea; border-radius:10px; margin-top:8px; background:#fcfeff;}

  pre.rout{background:#f6f6f6; border:1px solid #ddd; border-radius:10px; padding:10px 12px; overflow-x:auto;}
  pre,code{font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; font-size: 13px;}

  .chips{display:flex; flex-wrap:wrap; gap:8px; margin:10px 0 0;}
  .chip{border-radius:999px; padding:6px 10px; border:1px solid var(--line); background:#fff; font-weight:800; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto;}
  .chip small{font-weight:700; opacity:.75; margin-right:6px;}
  .chip.grand{border-color:#cbd5e1; color:var(--c-grand);}
  .chip.right{border-color:#bfdbfe; background:#eff6ff; color:var(--c-right);}
  .chip.mixed{border-color:#ddd6fe; background:#f5f3ff; color:var(--c-mixed);}
  .chip.cell{border-color:#fde68a; background:#fffbeb; color:#92400e;}

  .calc-row{display:grid; grid-template-columns: 1fr; gap:10px; border:1px solid var(--line); border-radius:12px; padding:12px; background:#fbfeff; margin:10px 0;}
  @media (min-width: 980px){ .calc-row{grid-template-columns: 1.2fr .8fr;} }

  .calc-box{border:1px solid #cfe3ea; background:var(--teal2); border-radius:12px; padding:10px 12px;}
  .calc-box label{display:block; font-weight:900; color:var(--teal); margin-bottom:6px;}
  .calc-box input{width:100%; padding:10px 10px; border-radius:10px; border:1px solid #cfe3ea; font-size:15px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;}
  .btns{display:flex; gap:8px; flex-wrap:wrap; margin-top:8px;}
  button{cursor:pointer; border-radius:10px; border:1px solid var(--line); background:#fff; padding:8px 10px; font-weight:800;}
  button.primary{border-color:#cfe3ea; background:#e3f1f5; color:var(--teal);} 
  button.danger{border-color:#fecaca; background:#fff1f2; color:var(--bad);} 

  .feedback{margin-top:8px; font-weight:900; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto;}
  .ok{color:var(--good);} .no{color:var(--bad);} 
  .step{margin-top:8px; padding:10px 12px; border-left:4px solid #cfe3ea; background:#fcfeff; border-radius:10px;}

  table.tbl{border-collapse:collapse; width:100%; margin:10px 0;}
  table.tbl th, table.tbl td{border:1px solid #bbb; padding:6px 8px; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto; font-size: 13px;}
  table.tbl th{background:#f0f0f0;}
  table.tbl input{width:100%; padding:8px; border-radius:8px; border:1px solid #cbd5e1; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;}
  .right{text-align:right;}
  .center{text-align:center;}

  .hidden{display:none;}
</style>
</head>
<body>
<header>
  <h1>SG3 Problem 6 — Interactive Worksheet App</h1>
  <p>Production-style practice: you compute, the app checks, and the answer key stays hidden until you reveal it. R output is right where you need it.</p>
</header>

<div class="container">

  <div class="card">
    <div class="kpi">
      <div class="pill">Design: 3×3 split-plot</div>
      <div class="pill">Between: brain damage (Left/Right/Control)</div>
      <div class="pill">Within: string type (Digits/Letters/Mixed)</div>
      <div class="pill">n = 18 subjects</div>
    </div>
    <div class="panel" style="margin-top:12px;">
      <h4>Prompt (from SG3)</h4>
      <p>We are looking at subjects’ ability to recall characters in a string based on (a) the type of string (digits/letters/mixed — within-subject factor) and (b) the type of brain damage the subject suffered (left brain / right brain / control — between-subject factor). The experiment is using a 3×3 design; n = 18. Note: when we tested assumptions we found equality of variances as well as equality of the covariance/variance matrices.</p>
    </div>
  </div>

  <!-- 6a -->
  <section class="card" id="p6a">
    <h2>6a — Fixed effects (α, β, αβ)</h2>

    <div class="grid two">
      <div>
        <div class="panel">
          <h4>Mini-lesson (short): what is an “effect” here?</h4>
          <p>In this question, an “effect” is a <strong>difference among means</strong>. You’ll plug in the relevant mean and subtract the grand mean (or combine means for the interaction cell effect).</p>
          <ul>
            <li><strong>Damage effect</strong> (Right): use the Right damage marginal mean.</li>
            <li><strong>Stimuli effect</strong> (Mixed): use the Mixed stimuli marginal mean.</li>
            <li><strong>Cell interaction effect</strong> (Right×Mixed): compare the cell mean to what you’d expect from the two main effects.</li>
          </ul>
        </div>

        <div class="chips" id="chips-6a"></div>

        <div class="calc-row">
          <div>
            <h3>Compute + check</h3>
            <p class="muted" style="margin-top:0;">Type your numeric answer, click <strong>Check</strong>. Use 2 decimal places. Answers stay hidden until you click <strong>Reveal</strong>.</p>

            <div class="calc-box" data-prob="a_right">
              <label>α<sub>right</sub> = \(\bar Y_{right\cdot\cdot} - \bar Y_{\cdot\cdot\cdot}\)</label>
              <input inputmode="decimal" placeholder="e.g., 0.13" />
              <div class="btns">
                <button class="primary" data-action="check">Check</button>
                <button data-action="steps">Show steps</button>
                <button class="danger" data-action="reveal">Reveal answer</button>
              </div>
              <div class="feedback" aria-live="polite"></div>
              <div class="step hidden"></div>
            </div>

            <div class="calc-box" data-prob="b_mixed">
              <label>β<sub>mixed</sub> = \(\bar Y_{\cdot mixed\cdot} - \bar Y_{\cdot\cdot\cdot}\)</label>
              <input inputmode="decimal" placeholder="e.g., -0.37" />
              <div class="btns">
                <button class="primary" data-action="check">Check</button>
                <button data-action="steps">Show steps</button>
                <button class="danger" data-action="reveal">Reveal answer</button>
              </div>
              <div class="feedback" aria-live="polite"></div>
              <div class="step hidden"></div>
            </div>

            <div class="calc-box" data-prob="ab_right_mixed">
              <label>(αβ)<sub>right,mixed</sub> = \(\bar Y_{right,mixed\cdot} - \bar Y_{right\cdot\cdot} - \bar Y_{\cdot mixed\cdot} + \bar Y_{\cdot\cdot\cdot}\)</label>
              <input inputmode="decimal" placeholder="e.g., -0.07" />
              <div class="btns">
                <button class="primary" data-action="check">Check</button>
                <button data-action="steps">Show steps</button>
                <button class="danger" data-action="reveal">Reveal answer</button>
              </div>
              <div class="feedback" aria-live="polite"></div>
              <div class="step hidden"></div>
            </div>
          </div>

          <div>
            <details class="pill" open>
              <summary>Show R output (given in SG3)</summary>
              <div class="answer">
                <pre class="rout"><code>em6.damage
##  damagef emmean    SE df lower.CL upper.CL
##  Left      6.17 0.254 15     5.62     6.71
##  Right     7.61 0.254 15     7.07     8.15
##  Control   8.67 0.254 15     8.12     9.21
##
## Results are averaged over the levels of: stimuli
## Confidence level used: 0.95

em6.stimuli
##  stimuli emmean    SE df lower.CL upper.CL
##  digits    8.06 0.218 15     7.59     8.52
##  letters   7.28 0.259 15     6.72     7.83
##  mixed     7.11 0.251 15     6.58     7.65
##
## Results are averaged over the levels of: damagef
## Confidence level used: 0.95

em6.cell
##  damagef stimuli emmean    SE df lower.CL upper.CL
##  Left    digits    7.00 0.378 15     6.20     7.80
##  Right   digits    8.17 0.378 15     7.36     8.97
##  Control digits    9.00 0.378 15     8.20     9.80
##  Left    letters   5.67 0.449 15     4.71     6.62
##  Right   letters   7.50 0.449 15     6.54     8.46
##  Control letters   8.67 0.449 15     7.71     9.62
##  Left    mixed     5.83 0.435 15     4.91     6.76
##  Right   mixed     7.17 0.435 15     6.24     8.09
##  Control mixed     8.33 0.435 15     7.41     9.26
##
## Confidence level used: 0.95</code></pre>
              </div>
            </details>
          </div>
        </div>
      </div>

      <div>
        <div class="panel">
          <h4>Quick sanity check (what you should see)</h4>
          <ul>
            <li>Right mean is slightly above the grand mean → α<sub>right</sub> should be small positive.</li>
            <li>Mixed mean is below the grand mean → β<sub>mixed</sub> should be negative.</li>
            <li>Right×Mixed cell is close to what main effects predict → interaction cell effect should be near 0.</li>
          </ul>
        </div>
      </div>
    </div>
  </section>

  <!-- 6b -->
  <section class="card" id="p6b">
    <h2>6b — Fill in the ANOVA table (you fill; app checks)</h2>
    <div class="panel">
      <h4>Prompt (SG3)</h4>
      <p>Fill in this ANOVA table. Given SS: Damage=57; Stimuli=9; Subject=17.4; Damage×Stimuli=2; Subject×Stimuli=30.6</p>
    </div>

    <div class="panel">
      <h4>Mini-lesson (short): which MS is the denominator?</h4>
      <ul>
        <li><strong>Damage (between-subject)</strong> uses <strong>Subjects within Damage</strong> as the error term.</li>
        <li><strong>Stimuli</strong> and <strong>Damage×Stimuli</strong> (within-subject) use <strong>Stimuli×Subjects within Damage</strong> as the error term.</li>
      </ul>
    </div>

    <div class="card" style="border-radius:12px;">
      <h3>ANOVA table — enter df, MS, F</h3>
      <p class="muted" style="margin-top:0;">Type your values and click <strong>Check all</strong>. You can reveal the key if you get stuck.</p>

      <div class="btns">
        <button class="primary" id="check-6b">Check all</button>
        <button id="reveal-6b" class="danger">Reveal key</button>
        <button id="reset-6b">Reset</button>
      </div>
      <div id="fb-6b" class="feedback" aria-live="polite"></div>

      <table class="tbl" id="anova-6b">
        <thead>
          <tr>
            <th>Source</th>
            <th class="right">SS (given)</th>
            <th class="center">df</th>
            <th class="center">MS</th>
            <th class="center">F</th>
          </tr>
        </thead>
        <tbody>
          <tr data-row="A">
            <td>Damage (A)</td>
            <td class="right">57.0</td>
            <td><input data-field="df" placeholder="?" /></td>
            <td><input data-field="ms" placeholder="?" /></td>
            <td><input data-field="f" placeholder="?" /></td>
          </tr>
          <tr data-row="SA">
            <td>Subjects within Damage, S(A)</td>
            <td class="right">17.4</td>
            <td><input data-field="df" placeholder="?" /></td>
            <td><input data-field="ms" placeholder="?" /></td>
            <td class="center muted">—</td>
          </tr>
          <tr data-row="B">
            <td>Stimuli (B)</td>
            <td class="right">9.0</td>
            <td><input data-field="df" placeholder="?" /></td>
            <td><input data-field="ms" placeholder="?" /></td>
            <td><input data-field="f" placeholder="?" /></td>
          </tr>
          <tr data-row="BSA">
            <td>B×S(A) (within error)</td>
            <td class="right">30.6</td>
            <td><input data-field="df" placeholder="?" /></td>
            <td><input data-field="ms" placeholder="?" /></td>
            <td class="center muted">—</td>
          </tr>
          <tr data-row="AB">
            <td>Damage×Stimuli (A×B)</td>
            <td class="right">2.0</td>
            <td><input data-field="df" placeholder="?" /></td>
            <td><input data-field="ms" placeholder="?" /></td>
            <td><input data-field="f" placeholder="?" /></td>
          </tr>
        </tbody>
      </table>

      <details class="pill">
        <summary>Show full key (filled table + how the denominators work)</summary>
        <div class="answer">
          <p><strong>Key df:</strong> A:2; S(A):15; B:2; B×S(A):30; A×B:4.</p>
          <p><strong>Key MS:</strong> MS<sub>A</sub>=28.50; MS<sub>S(A)</sub>=1.16; MS<sub>B</sub>=4.50; MS<sub>B×S(A)</sub>=1.02; MS<sub>AB</sub>=0.50.</p>
          <p><strong>Key F:</strong> F<sub>A</sub>=24.57 (denom MS<sub>S(A)</sub>); F<sub>B</sub>=4.41 (denom MS<sub>B×S(A)</sub>); F<sub>AB</sub>=0.49 (denom MS<sub>B×S(A)</sub>).</p>
        </div>
      </details>
    </div>
  </section>

  <!-- 6c -->
  <section class="card" id="p6c">
    <h2>6c — Contrasts (type, null, adjustment, interpret)</h2>
    <div class="panel">
      <h4>Prompt (SG3)</h4>
      <p>For each contrast: (a) identify the type of contrast; (b) write the null hypothesis that contrast is testing; (c) calculate the appropriate posthoc-adjusted critical value; and (d) interpret the contrast, including directionality. Use the Tukey adjustment for pairwise contrasts; use the Scheffe adjustment for complex contrasts.</p>
    </div>

    <div class="panel">
      <h4>Mini-lesson (short): what are you doing in 6c?</h4>
      <ol>
        <li>Translate the contrast vector into an English comparison.</li>
        <li>Write the null hypothesis for that comparison.</li>
        <li>Pick Tukey (pairwise) or Scheffé (complex), then get the adjusted critical value.</li>
        <li>Use the SG3 t.ratio + sign to decide significance + direction.</li>
      </ol>
    </div>

    <details class="pill" open>
      <summary>Show R output (given in SG3)</summary>
      <div class="answer">
        <pre class="rout"><code>contrast(em6.damage, damage6.list)
##  contrast    estimate    SE df t.ratio p.value
##  c(-2, 1, 1)     3.94 0.623 15   6.335 <0.0001
##
## Results are averaged over the levels of: stimuli

contrast(em6.stimuli, stimuli6.list)
##  contrast    estimate    SE df t.ratio p.value
##  c(1, 0, -1)    0.944 0.311 15   3.034  0.0084
##
## Results are averaged over the levels of: damagef

contrast(em6.cell, cell6.list)
##  contrast                        estimate    SE df t.ratio p.value
##  c(-2, 1, 1, 0, 0, 0, 0, 0, 0)      3.167 0.925 15   3.424  0.0038
##  c(0, 0, 0, 0, 0, 0, -2, 1, 1)      3.833 1.060 15   3.601  0.0026
##  c(-2, 1, 1, 0, 0, 0, 2, -1, -1)   -0.667 1.320 15  -0.505  0.6211</code></pre>
      </div>
    </details>

    <div class="card" style="border-radius:12px;">
      <h3>Production-style worksheet (concise)</h3>
      <p class="muted" style="margin-top:0;">(Next pass) I’ll turn each contrast into a checked worksheet like 6a/6b (dropdowns + null textbox + check). For now, the full step-by-step interpretations are still available below.</p>

      <details class="pill">
        <summary>Show step-by-step (current)</summary>
        <div class="answer">
          <div class="panel">
            <h4>Contrast meanings (English)</h4>
            <ul>
              <li><code>c(-2,1,1)</code> on damage means: compare <strong>Left</strong> to the <strong>average</strong> of Right and Control.</li>
              <li><code>c(1,0,-1)</code> on stimuli means: compare <strong>Digits</strong> vs <strong>Mixed</strong>.</li>
              <li>The first two cell contrasts repeat the Left vs avg(Right,Control) comparison <em>within Digits</em> and <em>within Mixed</em>.</li>
              <li>The last cell contrast is a difference of those simple effects (interaction-style).</li>
            </ul>
          </div>

          <div class="panel">
            <h4>Nulls (examples)</h4>
            <ul>
              <li><strong>Damage contrast:</strong> \(H_0: \mu_L = (\mu_R+\mu_C)/2\).</li>
              <li><strong>Stimuli contrast:</strong> \(H_0: \mu_{digits} - \mu_{mixed} = 0\).</li>
            </ul>
          </div>

          <div class="panel">
            <h4>Adjustment rule</h4>
            <ul>
              <li>Pairwise → Tukey</li>
              <li>Complex / average-vs-mean / interaction-style → Scheffé</li>
            </ul>
          </div>

          <div class="panel">
            <h4>Decisions (using t.ratio)</h4>
            <ul>
              <li>Damage contrast: t = 6.335 (strong evidence; Right/Control average &gt; Left)</li>
              <li>Stimuli contrast digits vs mixed: t = 3.034 (digits &gt; mixed)</li>
              <li>Interaction-style cell contrast: t = -0.505 (ns)</li>
            </ul>
          </div>
        </div>
      </details>
    </div>
  </section>

</div>

<script>
  // ------------------------------
  // Utilities
  // ------------------------------
  function toNum(s){
    if (s === null || s === undefined) return null;
    const x = String(s).trim().replace(/,/g,'');
    if (x==='') return null;
    const v = Number(x);
    return Number.isFinite(v) ? v : null;
  }
  function closeEnough(a,b,tol=0.02){
    return Math.abs(a-b) <= tol;
  }

  // ------------------------------
  // 6a chips + calculators
  // ------------------------------
  const means6a = {
    grand: 7.48,
    right: 7.61,
    mixed: 7.11,
    cell_right_mixed: 7.17,
  };

  const expected6a = {
    a_right: { value: +(means6a.right - means6a.grand).toFixed(2), steps: () => `α_right = Ȳ_right − Ȳ... = ${means6a.right} − ${means6a.grand} = ${(means6a.right-means6a.grand).toFixed(2)}` },
    b_mixed: { value: +(means6a.mixed - means6a.grand).toFixed(2), steps: () => `β_mixed = Ȳ_mixed − Ȳ... = ${means6a.mixed} − ${means6a.grand} = ${(means6a.mixed-means6a.grand).toFixed(2)}` },
    ab_right_mixed: {
      value: +(means6a.cell_right_mixed - means6a.right - means6a.mixed + means6a.grand).toFixed(2),
      steps: () => `αβ_right,mixed = Ȳ_right,mixed − Ȳ_right − Ȳ_mixed + Ȳ... = ${means6a.cell_right_mixed} − ${means6a.right} − ${means6a.mixed} + ${means6a.grand} = ${(means6a.cell_right_mixed - means6a.right - means6a.mixed + means6a.grand).toFixed(2)}`
    }
  };

  (function renderChips(){
    const el = document.getElementById('chips-6a');
    if (!el) return;
    el.innerHTML = `
      <div class="chip grand"><small>Grand mean</small>${means6a.grand}</div>
      <div class="chip right"><small>Right mean</small>${means6a.right}</div>
      <div class="chip mixed"><small>Mixed mean</small>${means6a.mixed}</div>
      <div class="chip cell"><small>Right×Mixed cell</small>${means6a.cell_right_mixed}</div>
    `;
  })();

  (function init6a(){
    document.querySelectorAll('.calc-box[data-prob]').forEach(box => {
      const key = box.getAttribute('data-prob');
      const input = box.querySelector('input');
      const fb = box.querySelector('.feedback');
      const step = box.querySelector('.step');
      const exp = expected6a[key];

      function setFeedback(ok, msg){
        fb.textContent = msg;
        fb.className = 'feedback ' + (ok ? 'ok' : 'no');
      }

      box.querySelectorAll('button[data-action]').forEach(btn => {
        btn.addEventListener('click', () => {
          const action = btn.getAttribute('data-action');
          if (action === 'check'){
            const v = toNum(input.value);
            if (v === null){
              setFeedback(false, 'Enter a number first.');
              return;
            }
            if (closeEnough(v, exp.value)) setFeedback(true, 'Correct.');
            else setFeedback(false, `Not quite. (Your: ${v}; expected is near ${exp.value})`);
          }
          if (action === 'steps'){
            step.classList.toggle('hidden');
            step.textContent = exp.steps();
          }
          if (action === 'reveal'){
            input.value = exp.value.toFixed(2);
            setFeedback(true, `Revealed: ${exp.value.toFixed(2)}`);
          }
        });
      });
    });
  })();

  // ------------------------------
  // 6b: ANOVA table checks
  // ------------------------------
  const expected6b = {
    A:  { df:2,  ms:28.50, f:24.57 },
    SA: { df:15, ms:1.16 },
    B:  { df:2,  ms:4.50,  f:4.41 },
    BSA:{ df:30, ms:1.02 },
    AB: { df:4,  ms:0.50,  f:0.49 },
  };

  function getRow(rowKey){
    return document.querySelector(`#anova-6b tr[data-row="${rowKey}"]`);
  }

  function checkCell(input, expected, tol){
    const v = toNum(input.value);
    if (v === null) return { ok:false, msg:'blank' };
    const ok = closeEnough(v, expected, tol);
    return { ok, msg: ok ? 'ok' : `exp≈${expected}` };
  }

  (function init6b(){
    const fb = document.getElementById('fb-6b');
    const checkBtn = document.getElementById('check-6b');
    const revealBtn = document.getElementById('reveal-6b');
    const resetBtn = document.getElementById('reset-6b');

    function setMsg(ok, msg){
      fb.textContent = msg;
      fb.className = 'feedback ' + (ok ? 'ok' : 'no');
    }

    function checkAll(){
      let okAll = true;
      let missing = 0;

      ['A','SA','B','BSA','AB'].forEach(k => {
        const tr = getRow(k);
        if (!tr) return;
        const exp = expected6b[k];
        tr.querySelectorAll('input').forEach(inp => {
          inp.style.outline = '';
        });

        // df
        const dfInp = tr.querySelector('input[data-field="df"]');
        if (dfInp){
          const r = checkCell(dfInp, exp.df, 0.01);
          if (r.msg==='blank') missing++;
          if (!r.ok){ okAll=false; dfInp.style.outline='2px solid #fca5a5'; }
          else dfInp.style.outline='2px solid #86efac';
        }

        // ms
        const msInp = tr.querySelector('input[data-field="ms"]');
        if (msInp){
          const r = checkCell(msInp, exp.ms, 0.03);
          if (r.msg==='blank') missing++;
          if (!r.ok){ okAll=false; msInp.style.outline='2px solid #fca5a5'; }
          else msInp.style.outline='2px solid #86efac';
        }

        // f (only for rows with it)
        const fInp = tr.querySelector('input[data-field="f"]');
        if (fInp && exp.f !== undefined){
          const r = checkCell(fInp, exp.f, 0.05);
          if (r.msg==='blank') missing++;
          if (!r.ok){ okAll=false; fInp.style.outline='2px solid #fca5a5'; }
          else fInp.style.outline='2px solid #86efac';
        }
      });

      if (missing>0) setMsg(false, `Some cells are blank (${missing}). Fill them then re-check.`);
      else if (okAll) setMsg(true, 'All correct.');
      else setMsg(false, 'Some entries are off. Red outlines = fix those cells.');
    }

    function reveal(){
      Object.keys(expected6b).forEach(k => {
        const tr = getRow(k);
        if (!tr) return;
        const exp = expected6b[k];
        const dfInp = tr.querySelector('input[data-field="df"]');
        if (dfInp) dfInp.value = exp.df;
        const msInp = tr.querySelector('input[data-field="ms"]');
        if (msInp) msInp.value = exp.ms.toFixed(2);
        const fInp = tr.querySelector('input[data-field="f"]');
        if (fInp && exp.f !== undefined) fInp.value = exp.f.toFixed(2);
      });
      setMsg(true, 'Key revealed.');
    }

    function reset(){
      document.querySelectorAll('#anova-6b input').forEach(i => { i.value=''; i.style.outline=''; });
      setMsg(true, 'Reset.');
    }

    checkBtn?.addEventListener('click', checkAll);
    revealBtn?.addEventListener('click', reveal);
    resetBtn?.addEventListener('click', reset);
  })();
</script>

<!-- MathJax -->
<script>
  window.MathJax = {
    tex: {
      inlineMath: [['\\(','\\)'], ['$', '$']],
      displayMath: [['\\[','\\]'], ['$$', '$$']],
      processEscapes: true
    },
    options: { skipHtmlTags: ['script','noscript','style','textarea','pre','code'] }
  };
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

</body>
</html>
